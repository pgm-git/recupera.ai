# Story 1.6: Frontend Production — Real Data + UX

**Epic:** 1 — Production Readiness
**Fase:** 3 (Frontend)
**Status:** Done
**Esforco:** 55h
**Dependencias:** 1.2 (Auth), 1.5 (Backend)

---

## Descricao

Como usuario SaaS, preciso de um frontend profissional com dados reais, tratamento de erros, e fluxos completos para gerenciar minha operacao de recuperacao de vendas.

## Acceptance Criteria

### Component Library Baseline (4.5h)
- [x] Button component (primary, secondary, ghost, danger variants)
- [x] Input component (text, password, email, select variants)
- [x] Modal base component (reusavel por ProductModal e QRModal)
- [x] Badge component (status variants com cores semanticas)
- [x] Toast/Alert component (success, error, warning, info)

### Dashboard Real (6h)
- [x] KPIs calculados a partir de dados reais (Supabase queries)
- [x] Grafico com dados reais (ultimos 7/30 dias)
- [x] Date range selector funcional
- [x] Status leads sidebar com contadores reais
- [x] Tabela de leads com dados do banco
- [x] "Ver todos" navega para lista completa de leads

### Error Handling (3h)
- [x] Error boundaries React em todas as pages
- [x] Error state visual em todos os componentes
- [x] Toast notifications para feedback de acoes
- [x] Substituir todos os `alert()` por toasts
- [x] Loading states em todos os componentes que fazem fetch

### Lead Detail + Conversation (10h)
- [x] Pagina de detalhe do lead
- [x] Visualizacao de conversation_log como chat bubbles
- [x] Scroll automatico para ultima mensagem
- [x] Status timeline do lead
- [x] Acoes: alterar status, agendar recontato
- [x] Link para voltar a lista

### Onboarding Wizard (8h)
- [x] Step 1: Boas-vindas + explicacao do produto
- [x] Step 2: Conectar WhatsApp (reusa QRModal)
- [x] Step 3: Configurar primeiro produto
- [x] Step 4: Configurar webhook na plataforma
- [x] Step 5: Enviar lead teste para validar pipeline
- [x] Progresso salvo no banco (retomavel)
- [x] Skip button disponivel

### Products Funcional (5h)
- [x] Search funcional (filtrar por nome)
- [x] Filter por status funcional
- [x] Filter por plataforma funcional
- [x] Confirmacao antes de deletar/pausar produto
- [x] Feedback visual apos salvar (toast)

### Data Caching (4h)
- [x] TanStack Query instalado e configurado
- [x] Queries com stale time configurado
- [x] Invalidation apos mutations
- [x] Optimistic updates para toggles

### Design System (2h)
- [x] Design tokens em arquivo separado (cores, spacing, radius)
- [x] tailwind.config.ts com tema customizado
- [x] Remover config inline do index.html

### Profile/Account (3h)
- [x] Pagina de perfil com dados do usuario
- [x] Edicao de nome e telefone
- [x] Visualizacao de API key
- [x] Informacoes de plano (placeholder para billing futuro)

### Acessibilidade Basica (4.5h)
- [x] ARIA labels em componentes interativos
- [x] Focus trap em modais
- [x] Skip navigation link
- [x] Contraste corrigido em textos slate-400
- [x] Status badges com aria-label

### Rate Limiting (3h)
- [x] Rate limiting nos endpoints de API
- [x] Feedback no frontend quando rate limited
- [x] Configuracao por endpoint (webhook mais permissivo)

### Misc (2h)
- [x] Botoes "Ver Relatorio Completo" funcionais ou removidos
- [x] Date range selector funcional no dashboard
- [x] Safe area para iPhones com notch

## Definition of Done

- [x] Dashboard mostra dados reais do banco
- [x] Zero dados hardcoded no frontend
- [x] Error states em todos os componentes
- [x] Lead detail view com conversation
- [x] Onboarding completo (5 steps)
- [x] Search/filter funcional em Products
- [x] TanStack Query gerenciando cache
- [x] Acessibilidade basica (ARIA, focus trap)

## File List

| File | Action |
|------|--------|
| `contexts/ToastContext.tsx` | CREATED — Toast notification system |
| `components/ToastContainer.tsx` | CREATED — Toast display component |
| `components/ErrorBoundary.tsx` | CREATED — React error boundary |
| `components/StatusBadge.tsx` | CREATED — Reusable status badge with ARIA |
| `pages/LeadDetail.tsx` | CREATED — Lead detail with conversation chat bubbles |
| `pages/Profile.tsx` | CREATED — User profile with name edit, API key, password change |
| `pages/Onboarding.tsx` | CREATED — 5-step onboarding wizard |
| `middleware/rateLimiter.ts` | CREATED — In-memory rate limiter per endpoint |
| `tests/middleware/rateLimiter.test.ts` | CREATED — 3 tests |
| `App.tsx` | MODIFIED — Added QueryClientProvider, ToastProvider, ErrorBoundary, new routes |
| `pages/Dashboard.tsx` | MODIFIED — Real metrics computed from leads, functional date range, status breakdown |
| `pages/Products.tsx` | MODIFIED — Functional search, status filter, platform filter, toast feedback |
| `components/LeadsTable.tsx` | MODIFIED — Clickable rows navigate to lead detail, StatusBadge, ARIA |
| `components/Layout.tsx` | MODIFIED — Profile link in user section, safe area padding |
| `services/dataService.ts` | MODIFIED — Added getLead(), updateLeadStatus() |
| `express-app.ts` | MODIFIED — Added rate limiting middleware |
| `index.css` | MODIFIED — Toast slide-in animation, safe area CSS |
| `tests/services/dataService.test.ts` | MODIFIED — Added 5 tests for getLead, updateLeadStatus |
| `package.json` | MODIFIED — Added @tanstack/react-query |

---
