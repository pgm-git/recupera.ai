# Story 1.1: Security Emergency — Credenciais e Hardening

**Epic:** 1 — Production Readiness
**Fase:** 0 (Emergencia)
**Status:** Draft
**Esforco:** 10h
**Dependencias:** Nenhuma (primeira story)

---

## Descricao

Como desenvolvedor, preciso remover todas as credenciais hardcoded do source code e aplicar hardening basico de seguranca, para que o repositorio possa ser compartilhado sem expor chaves de producao.

## Acceptance Criteria

- [ ] Todas as credenciais removidas de arquivos fonte (server.ts, main.py, ai_handler.py, celery_worker.py, lib/supabase.ts)
- [ ] `.env.example` criado com placeholders para todas as variaveis
- [ ] `.env` adicionado ao `.gitignore`
- [ ] `dotenv` configurado no Express (server.ts)
- [ ] `python-dotenv` configurado no FastAPI (main.py, ai_handler.py, celery_worker.py)
- [ ] CORS configurado com dominio especifico (nao wildcard `*`)
- [ ] Tailwind instalado localmente via npm (remover CDN do index.html)
- [ ] Dependencias bundled via Vite (remover importmap ESM CDN)
- [ ] Validacao de env vars obrigatorias no startup (ambos backends)
- [ ] `npm audit` executado e vulnerabilidades criticas resolvidas
- [ ] `pip audit` executado (ou requirements.txt com versoes pinadas)

## Technical Notes

### Arquivos a modificar:
- `server.ts` (linhas 18-24): SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, UAZAPI_API_KEY
- `backend/main.py` (linhas 30-36): mesmas variaveis
- `backend/ai_handler.py`: OPENAI_API_KEY, SUPABASE_*, UAZAPI_*
- `backend/celery_worker.py`: SUPABASE_*, REDIS_URL
- `lib/supabase.ts` (linhas 4-5): SUPABASE_URL, SUPABASE_ANON_KEY
- `index.html`: Remover Tailwind CDN script, remover importmap
- `vite.config.ts`: Configurar Tailwind plugin
- `package.json`: Adicionar tailwindcss, postcss, autoprefixer

### Variaveis de ambiente necessarias:
```
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
UAZAPI_API_KEY=
UAZAPI_BASE_URL=
OPENAI_API_KEY=
REDIS_URL=
CORS_ORIGIN=
NODE_ENV=
```

## Definition of Done

- [ ] Zero credenciais no source code (grep confirma)
- [ ] App inicia com .env corretamente
- [ ] App falha graciosamente sem .env (mensagem clara)
- [ ] `npm run dev` funciona com Tailwind local
- [ ] CORS rejeita origens nao autorizadas

## File List

*Atualizado durante implementacao*

---
