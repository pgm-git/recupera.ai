# Story 1.1: Security Emergency — Credenciais e Hardening

**Epic:** 1 — Production Readiness
**Fase:** 0 (Emergencia)
**Status:** Done
**Esforco:** 10h
**Dependencias:** Nenhuma (primeira story)

---

## Descricao

Como desenvolvedor, preciso remover todas as credenciais hardcoded do source code e aplicar hardening basico de seguranca, para que o repositorio possa ser compartilhado sem expor chaves de producao.

## Acceptance Criteria

- [x] Todas as credenciais removidas de arquivos fonte (server.ts, main.py, ai_handler.py, celery_worker.py, lib/supabase.ts)
- [x] `.env.example` criado com placeholders para todas as variaveis
- [x] `.env` adicionado ao `.gitignore`
- [x] `dotenv` configurado no Express (server.ts)
- [x] `python-dotenv` configurado no FastAPI (main.py, ai_handler.py, celery_worker.py)
- [x] CORS configurado com dominio especifico (nao wildcard `*`)
- [x] Tailwind instalado localmente via npm (remover CDN do index.html)
- [x] Dependencias bundled via Vite (remover importmap ESM CDN)
- [x] Validacao de env vars obrigatorias no startup (ambos backends)
- [x] `npm audit` executado e vulnerabilidades criticas resolvidas
- [x] `pip audit` executado (ou requirements.txt com versoes pinadas)

## Technical Notes

### Arquivos a modificar:
- `server.ts` (linhas 18-24): SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, UAZAPI_API_KEY
- `backend/main.py` (linhas 30-36): mesmas variaveis
- `backend/ai_handler.py`: OPENAI_API_KEY, SUPABASE_*, UAZAPI_*
- `backend/celery_worker.py`: SUPABASE_*, REDIS_URL
- `lib/supabase.ts` (linhas 4-5): SUPABASE_URL, SUPABASE_ANON_KEY
- `index.html`: Remover Tailwind CDN script, remover importmap
- `vite.config.ts`: Configurar Tailwind plugin
- `package.json`: Adicionar tailwindcss, postcss, autoprefixer

### Variaveis de ambiente necessarias:
```
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=
UAZAPI_API_KEY=
UAZAPI_BASE_URL=
OPENAI_API_KEY=
REDIS_URL=
CORS_ORIGIN=
NODE_ENV=
```

## Definition of Done

- [x] Zero credenciais no source code (grep confirma)
- [x] App inicia com .env corretamente
- [x] App falha graciosamente sem .env (mensagem clara)
- [x] `npm run dev` funciona com Tailwind local
- [x] CORS rejeita origens nao autorizadas

## File List

| File | Action | Description |
|------|--------|-------------|
| `server.ts` | Modified | Removed hardcoded credentials, added env validation, CORS with specific origin |
| `backend/main.py` | Modified | Removed hardcoded credentials, added env validation, CORS with specific origin |
| `backend/ai_handler.py` | Modified | Removed hardcoded credentials, added env validation |
| `backend/celery_worker.py` | Modified | Removed hardcoded credentials, added env validation |
| `lib/supabase.ts` | Modified | Use import.meta.env for Vite, removed hardcoded fallbacks |
| `index.html` | Modified | Removed Tailwind CDN, importmap, inline config |
| `index.css` | Created | Tailwind v4 entry with @theme brand colors |
| `index.tsx` | Modified | Added index.css import |
| `vite.config.ts` | Modified | Added @tailwindcss/vite plugin, removed Gemini references |
| `.env.example` | Modified | Added Recupera.AI-specific env vars |
| `backend/requirements.txt` | Modified | Pinned all Python dependency versions |
| `package.json` | Modified | Added tailwindcss and @tailwindcss/vite devDependencies |

---
