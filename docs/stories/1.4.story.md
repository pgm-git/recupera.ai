# Story 1.4: Test Foundation — Setup + Baseline Tests

**Epic:** 1 — Production Readiness
**Fase:** 1.5 (Testes)
**Status:** Draft
**Esforco:** 10h
**Dependencias:** 1.2 (Auth), 1.3 (DB Schema)

---

## Descricao

Como desenvolvedor, preciso de um framework de testes configurado e testes baseline para os endpoints e services existentes, para poder validar a migracao do backend Python sem regressoes.

## Acceptance Criteria

### Test Setup (2h)
- [ ] Vitest configurado com TypeScript support
- [ ] Test helpers para Supabase mock
- [ ] Test helpers para HTTP requests (supertest)
- [ ] npm scripts: `test`, `test:watch`, `test:coverage`
- [ ] Coverage report configurado (minimo: statements)

### Endpoint Tests (4h)
- [ ] Test: POST /api/webhooks/:clientId (Hotmart payload)
- [ ] Test: POST /api/webhooks/:clientId (Kiwify payload)
- [ ] Test: POST /api/whatsapp/webhook (UAZAPI message)
- [ ] Test: POST /api/whatsapp/connect/:clientId
- [ ] Test: GET /api/whatsapp/status/:clientId
- [ ] Test: Endpoints rejeitam requests sem auth
- [ ] Test: Endpoints rejeitam payloads invalidos

### Service Tests (2h)
- [ ] Test: dataService.getLeads() filtra por client_id
- [ ] Test: dataService.saveProductConfig() valida campos
- [ ] Test: apiService.connectWhatsApp() handles errors
- [ ] Test: apiService.getStatus() handles timeout

### Feature Parity Checklist (2h)
- [ ] Documentar TODOS os comportamentos do FastAPI/Python
- [ ] Mapear cada endpoint Python → equivalente Node.js
- [ ] Identificar logica unica no ai_handler.py
- [ ] Identificar logica unica no celery_worker.py
- [ ] Checklist pronto para validacao pos-migracao

## Technical Notes

- Usar Vitest (compativel com Vite, mais rapido que Jest)
- Mocks de Supabase via `vi.mock()` ou test client
- supertest para endpoint testing
- Coverage target: 60% statements para esta story

## Definition of Done

- [ ] `npm test` roda sem erros
- [ ] Coverage >= 30% (baseline, sera expandido)
- [ ] Feature parity checklist documentado
- [ ] Todos os endpoints criticos tem pelo menos 1 teste

## File List

*Atualizado durante implementacao*

---
